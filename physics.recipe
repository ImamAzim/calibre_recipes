#!/usr/bin/env python
# vim:fileencoding=utf-8
from calibre.web.feeds.news import BasicNewsRecipe
import datetime
import dateutil.parser

from bs4 import BeautifulSoup


class AdvancedUserRecipe1691408719(BasicNewsRecipe):
    title          = 'physics'
    oldest_article = 3
    max_articles_per_feed = 100
    auto_cleanup   = True
    index_url = 'https://physicsworld.com/feed'

    def parse_index(self):
        raw_soup = self.index_to_soup(self.index_url, raw=True)
        soup = BeautifulSoup(raw_soup, 'xml')

        articles = list()

        for div in soup.find_all('item'):
            date_text=div.find('pubDate').text.strip()[0:-6]
            date = dateutil.parser.parse(date_text)
            article_age = datetime.datetime.now()-date
            if article_age.days <= self.oldest_article:
                title = div.title.text
                description=div.find('description').text
                url=div.find('link').text
                article = dict(
                        title=title,
                        url=url,
                        date=date_text,
                        description=description,
                        )
                articles.append(article)
        feeds = [('Articles', articles)]
        return feeds


