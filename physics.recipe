#!/usr/bin/env python
# vim:fileencoding=utf-8
from calibre.web.feeds.news import BasicNewsRecipe
import datetime

from bs4 import BeautifulSoup


class AdvancedUserRecipe1691408719(BasicNewsRecipe):
    title          = 'physics'
    oldest_article = 3
    max_articles_per_feed = 100
    auto_cleanup   = True
    index_url = 'https://physicsworld.com/feed'

    def parse_index(self):
        raw_soup = self.index_to_soup(self.index_url, raw=True)
        soup = BeautifulSoup(raw_soup, 'xml')

        articles = list()

        for div in soup.find_all('item'):
            title = div.title.text
            date=div.find('pubDate').text
            date_iso = datetime.datetime.strptime(date[0:-6], '%a, %d %b %Y %H:%M:%S').isoformat()
            description=div.find('description').text
            url=div.find('link').text
            article = dict(
                    title=title,
                    url=url,
                    date=iso_date,
                    description=description,
                    )
            articles.append(article)
        feeds = [('Articles', articles)]
        return feeds


